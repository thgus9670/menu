<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>PDF 책 넘김 뷰어 (원본 비율)</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    background: #f0f0f0;
    touch-action: pan-y;
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
  }
  #pdf-container {
    position: relative;
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
  }
  canvas {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    backface-visibility: hidden;
    border-radius: 0;
  }
  /* 책 넘김 애니메이션 */
  .flip-enter {
    animation: flipEnter 0.5s forwards;
  }
  .flip-exit {
    animation: flipExit 0.5s forwards;
  }
  @keyframes flipEnter {
    from { transform: translate(-50%, -50%) rotateY(90deg); opacity: 0; }
    to   { transform: translate(-50%, -50%) rotateY(0deg); opacity: 1; }
  }
  @keyframes flipExit {
    from { transform: translate(-50%, -50%) rotateY(0deg); opacity: 1; }
    to   { transform: translate(-50%, -50%) rotateY(-90deg); opacity: 0; }
  }
</style>
</head>
<body>

<div id="pdf-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
<script>
const url = 'hospital-guide.pdf'; // PDF 파일 경로

let pdfDoc = null;
let currentPage = 1;
let totalPages = 0;

const container = document.getElementById('pdf-container');

let canvasCurrent = document.createElement('canvas');
let ctxCurrent = canvasCurrent.getContext('2d');
canvasCurrent.style.zIndex = 2;
container.appendChild(canvasCurrent);

let canvasNext = document.createElement('canvas');
let ctxNext = canvasNext.getContext('2d');
canvasNext.style.zIndex = 1;
container.appendChild(canvasNext);

function renderPage(pageNum, canvas, ctx) {
    pdfDoc.getPage(pageNum).then(page => {
        const viewport = page.getViewport({ scale: 1 });
        const containerWidth = container.clientWidth;
        const containerHeight = container.clientHeight;

        // 원본 비율 유지하며 최대 크기 계산
        const scale = Math.min(containerWidth / viewport.width, containerHeight / viewport.height);
        const scaledViewport = page.getViewport({ scale: scale });

        canvas.width = scaledViewport.width;
        canvas.height = scaledViewport.height;

        const renderContext = {
            canvasContext: ctx,
            viewport: scaledViewport
        };
        page.render(renderContext);

        // 중앙 정렬
        canvas.style.width = scaledViewport.width + 'px';
        canvas.style.height = scaledViewport.height + 'px';
        canvas.style.top = '50%';
        canvas.style.left = '50%';
        canvas.style.transform = 'translate(-50%, -50%)';
    });
}

function flipToPage(newPage) {
    if(newPage < 1 || newPage > totalPages || newPage === currentPage) return;

    renderPage(newPage, canvasNext, ctxNext);

    canvasNext.className = 'flip-enter';
    canvasCurrent.className = 'flip-exit';

    canvasNext.addEventListener('animationend', () => {
        [canvasCurrent, canvasNext] = [canvasNext, canvasCurrent];
        [ctxCurrent, ctxNext] = [ctxNext, ctxCurrent];
        canvasCurrent.style.zIndex = 2;
        canvasNext.style.zIndex = 1;

        canvasCurrent.className = '';
        canvasNext.className = '';

        currentPage = newPage;
    }, { once: true });
}

// PDF 불러오기
pdfjsLib.getDocument(url).promise.then(pdf => {
    pdfDoc = pdf;
    totalPages = pdf.numPages;
    renderPage(currentPage, canvasCurrent, ctxCurrent);
});

// 터치 스와이프 처리
let startX = 0;
container.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX;
});
container.addEventListener('touchend', e => {
    let endX = e.changedTouches[0].clientX;
    let diff = endX - startX;
    if(Math.abs(diff) > 50) {
        if(diff > 0) {
            if(currentPage > 1) flipToPage(currentPage - 1);
        } else {
            if(currentPage < totalPages) flipToPage(currentPage + 1);
        }
    }
});
</script>
</body>
</html>
